/*
 * jQuery Autocomplete plugin 1.2.2
 * with minor modifications for deprecated jQuery
 *
 * Copyright (c) 2009 Jörn Zaefferer
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * With small modifications by Alfonso Gómez-Arzola.
 * See changelog for details.
 *
 */

!function(e){e.fn.extend({autocomplete:function(t,n){var a="string"==typeof t;return(n=e.extend({},e.Autocompleter.defaults,{url:a?t:null,data:a?null:t,delay:a?e.Autocompleter.defaults.delay:10,max:n&&!n.scroll?10:150,noRecord:"No Records."},n)).highlight=n.highlight||function(e){return e},n.formatMatch=n.formatMatch||n.formatItem,this.each(function(){new e.Autocompleter(this,n)})},result:function(e){return this.bind("result",e)},search:function(e){return this.trigger("search",[e])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(e){return this.trigger("setOptions",[e])},unautocomplete:function(){return this.trigger("unautocomplete")}}),e.Autocompleter=function(t,n){var a,i,r,l={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},o=null;null!=n.failure&&"function"==typeof n.failure&&(o=n.failure);var s=e(t).attr("autocomplete","off").addClass(n.inputClass),u="",c=e.Autocompleter.Cache(n),f=0,h={mouseDownOnSelect:!1},d=e.Autocompleter.Select(n,t,p,h);function p(){var a=d.selected();if(!a)return!1;var i=a.result;if(u=i,n.multiple){var r=v(s.val());if(r.length>1){var l,o=n.multipleSeparator.length,c=e(t).selection().start,f=0;e.each(r,function(e,t){if(c<=(f+=t.length))return l=e,!1;f+=o}),r[l]=i,i=r.join(n.multipleSeparator)}i+=n.multipleSeparator}return s.val(i),$(),s.trigger("result",[a.data,a.value]),!0}function m(e,t){if(i==l.DEL){d.hide();return}var a=s.val();(t||a!=u)&&(u=a,(a=g(a)).length>=n.minChars?(s.addClass(n.loadingClass),n.matchCase||(a=a.toLowerCase()),_(a,C,$)):(w(),d.hide()))}function v(t){return t?n.multiple?e.map(t.split(n.multipleSeparator),function(e){return t.trim().length?e.trim():null}):[t.trim()]:[""]}function g(a){if(!n.multiple)return a;var i=v(a);if(1==i.length)return i[0];var r=e(t).selection().start;return(i=r==a.length?v(a):v(a.replace(a.substring(r),"")))[i.length-1]}function $(){d.visible(),d.hide(),clearTimeout(a),w(),n.mustMatch&&s.search(function(e){if(!e){if(n.multiple){var t=v(s.val()).slice(0,-1);s.val(t.join(n.multipleSeparator)+(t.length?n.multipleSeparator:""))}else s.val(""),s.trigger("result",null)}})}function C(a,r){if(r&&r.length&&f){var o,c;w(),d.display(r,a),o=a,c=r[0].value,n.autoFill&&g(s.val()).toLowerCase()==o.toLowerCase()&&i!=l.BACKSPACE&&(s.val(s.val()+c.substring(g(u).length)),e(t).selection(u.length,u.length+c.length)),d.show()}else $()}function _(a,i,r){n.matchCase||(a=a.toLowerCase());var l=c.load(a);if(l)l.length?i(a,l):i(a,n.parse&&n.parse(n.noRecord)||b(n.noRecord));else if("string"==typeof n.url&&n.url.length>0){var s={timestamp:+new Date};e.each(n.extraParams,function(e,t){s[e]="function"==typeof t?t():t}),e.ajax({mode:"abort",port:"autocomplete"+t.name,dataType:n.dataType,url:n.url,data:e.extend({q:g(a),limit:n.max},s),success:function(e){var t=n.parse&&n.parse(e)||b(e);c.add(a,t),i(a,t)}})}else d.emptyList(),null!=o?o():r(a)}function b(e){for(var t=[],a=e.split("\n"),i=0;i<a.length;i++){var r=a[i].trim();r&&(r=r.split("|"),t[t.length]={data:r,value:r[0],result:n.formatResult&&n.formatResult(r,r[0])||r[0]})}return t}function w(){s.removeClass(n.loadingClass)}-1!=navigator.userAgent.indexOf("Opera")&&e(t.form).bind("submit.autocomplete",function(){if(r)return r=!1,!1}),s.bind((-1!=navigator.userAgent.indexOf("Opera")&&!1 in window?"keypress":"keydown")+".autocomplete",function(e){switch(f=1,i=e.keyCode,e.keyCode){case l.UP:d.visible()?(e.preventDefault(),d.prev()):m(0,!0);break;case l.DOWN:d.visible()?(e.preventDefault(),d.next()):m(0,!0);break;case l.PAGEUP:d.visible()?(e.preventDefault(),d.pageUp()):m(0,!0);break;case l.PAGEDOWN:d.visible()?(e.preventDefault(),d.pageDown()):m(0,!0);break;case n.multiple&&","==n.multipleSeparator.trim()&&l.COMMA:case l.TAB:case l.RETURN:if(p())return e.preventDefault(),r=!0,!1;break;case l.ESC:d.hide();break;default:clearTimeout(a),a=setTimeout(m,n.delay)}}).focus(function(){f++}).blur(function(){f=0,h.mouseDownOnSelect||(clearTimeout(a),a=setTimeout($,200))}).click(function(){n.clickFire?d.visible()||m(0,!0):f++>1&&!d.visible()&&m(0,!0)}).bind("search",function(){var t=arguments.length>1?arguments[1]:null;function n(e,n){var a;if(n&&n.length){for(var i=0;i<n.length;i++)if(n[i].result.toLowerCase()==e.toLowerCase()){a=n[i];break}}"function"==typeof t?t(a):s.trigger("result",a&&[a.data,a.value])}e.each(v(s.val()),function(e,t){_(t,n,n)})}).bind("flushCache",function(){c.flush()}).bind("setOptions",function(){e.extend(!0,n,arguments[1]),"data"in arguments[1]&&c.populate()}).bind("unautocomplete",function(){d.unbind(),s.unbind(),e(t.form).unbind(".autocomplete")})},e.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:100,max:1e3,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(e){return e[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:" ",inputFocus:!0,clickFire:!1,highlight:function(e,t){return e.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180,scrollJumpPosition:!0},e.Autocompleter.Cache=function(t){var n={},a=0;function i(e,n){t.matchCase||(e=e.toLowerCase());var a=e.indexOf(n);return"word"==t.matchContains&&(a=e.toLowerCase().search("\\b"+n.toLowerCase())),-1!=a&&(0==a||t.matchContains)}function r(e,i){a>t.cacheLength&&o(),!n[e]&&a++,n[e]=i}function l(){if(!t.data)return!1;var n={},a=0;t.url||(t.cacheLength=1),n[""]=[];for(var i=0,l=t.data.length;i<l;i++){var o=t.data[i];o="string"==typeof o?[o]:o;var s=t.formatMatch(o,i+1,t.data.length);if(void 0!==s&&!1!==s){var u=s.charAt(0).toLowerCase();n[u]||(n[u]=[]);var c={value:s,data:o,result:t.formatResult&&t.formatResult(o)||s};n[u].push(c),a++<t.max&&n[""].push(c)}}e.each(n,function(e,n){t.cacheLength++,r(e,n)})}function o(){n={},a=0}return setTimeout(l,25),{flush:o,add:r,populate:l,load:function(r){if(!t.cacheLength||!a)return null;if(!t.url&&t.matchContains){var l=[];for(var o in n)if(o.length>0){var s=n[o];e.each(s,function(e,t){i(t.value,r)&&l.push(t)})}return l}if(n[r])return n[r];if(t.matchSubset)for(var u=r.length-1;u>=t.minChars;u--){var s=n[r.substr(0,u)];if(s){var l=[];return e.each(s,function(e,t){i(t.value,r)&&(l[l.length]=t)}),l}}return null}}},e.Autocompleter.Select=function(t,n,a,i){var r,l,o,s,u={ACTIVE:"ac_over"},c=-1,f="",h=!0;function d(e){for(var t=e.target;t&&"LI"!=t.tagName;)t=t.parentNode;return t||[]}function p(e){r.slice(c,c+1).removeClass(u.ACTIVE),n=e,(t.scrollJumpPosition||!t.scrollJumpPosition&&!(n<0&&0==c||n>0&&c==r.size()-1))&&((c+=n)<0?c=r.size()-1:c>=r.size()&&(c=0));var n,a=r.slice(c,c+1).addClass(u.ACTIVE);if(t.scroll){var i=0;r.slice(0,c).each(function(){i+=this.offsetHeight}),i+a[0].offsetHeight-s.scrollTop()>s[0].clientHeight?s.scrollTop(i+a[0].offsetHeight-s.innerHeight()):i<s.scrollTop()&&s.scrollTop(i)}}return{display:function(p,m){h&&(o=e("<div/>").hide().addClass(t.resultsClass).css("position","absolute").appendTo(document.body).hover(function(t){e(this).is(":visible")&&n.focus(),i.mouseDownOnSelect=!1}),s=e("<ul/>").appendTo(o).mouseover(function(t){d(t).nodeName&&"LI"==d(t).nodeName.toUpperCase()&&(c=e("li",s).removeClass(u.ACTIVE).index(d(t)),e(d(t)).addClass(u.ACTIVE))}).click(function(i){return e(d(i)).addClass(u.ACTIVE),a(),t.inputFocus&&n.focus(),!1}).mousedown(function(){i.mouseDownOnSelect=!0}).mouseup(function(){i.mouseDownOnSelect=!1}),t.width>0&&o.css("width",t.width),h=!1),l=p,f=m,function n(){s.empty();for(var a,i=(a=l.length,t.max&&t.max<a?t.max:a),o=0;o<i;o++)if(l[o]){var h=t.formatItem(l[o].data,o+1,i,l[o].value,f);if(!1!==h){var d=e("<li/>").html(t.highlight(h,f)).addClass(o%2==0?"ac_even":"ac_odd").appendTo(s)[0];e.data(d,"ac_data",l[o])}}r=s.find("li"),t.selectFirst&&(r.slice(0,1).addClass(u.ACTIVE),c=0),e.fn.bgiframe&&s.bgiframe()}()},next:function(){p(1)},prev:function(){p(-1)},pageUp:function(){0!=c&&c-8<0?p(-c):p(-8)},pageDown:function(){c!=r.size()-1&&c+8>r.size()?p(r.size()-1-c):p(8)},hide:function(){o&&o.hide(),r&&r.removeClass(u.ACTIVE),c=-1},visible:function(){return o&&o.is(":visible")},current:function(){return this.visible()&&(r.filter("."+u.ACTIVE)[0]||t.selectFirst&&r[0])},show:function(){var a=e(n).offset();if(o.css({width:"string"==typeof t.width||t.width>0?t.width:e(n).width(),top:a.top+n.offsetHeight,left:a.left}).show(),t.scroll&&(s.scrollTop(0),s.css({maxHeight:t.scrollHeight,overflow:"auto"}),-1!=navigator.userAgent.indexOf("MSIE")&&void 0===document.body.style.maxHeight)){var i=0;r.each(function(){i+=this.offsetHeight});var l=i>t.scrollHeight;s.css("height",l?t.scrollHeight:i),l||r.width(s.width()-parseInt(r.css("padding-left"))-parseInt(r.css("padding-right")))}},selected:function(){var t=r&&r.filter("."+u.ACTIVE).removeClass(u.ACTIVE);return t&&t.length&&e.data(t[0],"ac_data")},emptyList:function(){s&&s.empty()},unbind:function(){o&&o.remove()}}},e.fn.selection=function(e,t){if(void 0!==e)return this.each(function(){if(this.createTextRange){var n=this.createTextRange();void 0===t||e==t?(n.move("character",e),n.select()):(n.collapse(!0),n.moveStart("character",e),n.moveEnd("character",t),n.select())}else this.setSelectionRange?this.setSelectionRange(e,t):this.selectionStart&&(this.selectionStart=e,this.selectionEnd=t)});var n=this[0];if(n.createTextRange){var a=document.selection.createRange(),i=n.value,r=a.text.length;a.text="<->";var l=n.value.indexOf("<->");return n.value=i,this.selection(l,l+r),{start:l,end:l+r}}if(void 0!==n.selectionStart)return{start:n.selectionStart,end:n.selectionEnd}}}(jQuery);